<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Addams Family | Quiz</title>
    <link rel="stylesheet" href="./css/dashboards.css" />
    <link rel="icon" href="./assets/icon/logosiyte.png" />
    <script src="./js/sessao.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <div class="janela">
        <div class="header-left">
            <div class="logo">
                <img src="./assets/icon/addams-family-seeklogo.png" class="logo" width="210px" height="90px" />
            </div>

            <div class="hello">
                <h1>Olá, <span id="b_usuario">Addams</span>!</h1>
            </div>

            <div class="btn-nav btn-selected">
                <a href="./dashboard.html">
                    <h3>Dashboard</h3>
                </a>
            </div>

            <div class="btn-nav">
                <a href="./quiz.html">
                    <h3>Quiz</h3>
                </a>
            </div>

            <div class="btn-logout" onclick="limparSessao()">
                <h3>Sair</h3>
            </div>
        </div>

        <div class="dash-content">
            <h2 class="titulo">Dashboard Quiz – Família Addams</h2>

            <div class="cards">
                <div class="card">
                    <h4>NÚMERO DE JOGADOR</h4>
                    <span id="cardJogadores"><br /><b></b></span>
                </div>

                <div class="card">
                    <h4>PERSONAGEM MAIS Exibido</h4>
                    <span id="cardMaisEscolhido"><br /></span>
                </div>

                <div class="card">
                    <h4>CARACTERÍSTICA MAIS ESCOLHIDA</h4>
                    <span id="cardCarac"><br /></span>
                </div>
            </div>

            <div class="graficos-grid">
                <div class="box-grafico">
                    <h3>Popularidade das Características</h3>
                    <canvas id="graficoCaracteristicas"></canvas>
                </div>

                <div class="box-grafico">
                    <h3>Top 5 Personagens</h3>
                    <canvas id="graficoTop5"></canvas>
                </div>

                <div class="box-grafico">
                    <h3>Resultados</h3>
                    <canvas id="graficoPersonagens"></canvas>
                </div>

                
              
            </div>
        </div>
    </div>
</body>

</html>

<script>
    function carregarGraficoCaracteristicas() {
        fetch("/dashboard/caracteristicas")
            .then((res) => res.json())
            .then((dados) => {
                const labels = dados.map((item) => item.Perguntas);
                const valores = dados.map((item) => item.qtd);

                new Chart(document.getElementById("graficoCaracteristicas"), {
                    type: "bar",
                    data: {
                        labels,
                        datasets: [
                            {
                                label: "Quantidade",
                                data: valores,
                            },
                        ],
                    },
                    options: {
                        indexAxis: "y",
                        responsive: true,
                    },
                });
            });
    }

    function carregarGraficoTop5() {
        fetch("/dashboard/top-personagens")
            .then((res) => res.json())
            .then((dados) => {
                const labels = dados.map((item) => item.nome);
                const valores = dados.map((item) => item.qtd);

                new Chart(document.getElementById("graficoTop5"), {
                    type: "bar",
                    data: {
                        labels,
                        datasets: [
                            {
                                label: "Aparições",
                                data: valores,
                            },
                        ],
                    },
                    options: {
                        responsive: true,
                    },
                });
            });
    }
    function carregarNumeroJogadores() {
        fetch("/dashboard/contar-usuarios")
            .then((res) => res.json())
            .then((dados) => {
                cardJogadores.innerHTML = `<br><b>${dados[0].qtd}</b>`;
            })
            .catch((err) => console.error("Erro:", err));
    }

    function carregarPersonagemMaisEscolhido() {
        fetch("/dashboard/personagem-mais-escolhido")
            .then((res) => res.json())
            .then((dados) => {
                cardMaisEscolhido.innerHTML = `<br><b>${dados[0].nome}</b>`;
            })
            .catch((err) => console.error("Erro:", err));
    }

    function carregarCaracteristicaMaisEscolhida() {
        fetch("/dashboard/caracteristica-mais-escolhida")
            .then((res) => res.json())
            .then((dados) => {
                cardCarac.innerHTML = `<br><b>${dados[0].Perguntas}</b>`;
            })
            .catch((err) => console.error("Erro:", err));
    }

    carregarGraficoCaracteristicas();
    carregarGraficoTop5();
    carregarNumeroJogadores();
    carregarPersonagemMaisEscolhido();
    carregarCaracteristicaMaisEscolhida();
</script>